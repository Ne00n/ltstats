<!DOCTYPE html><html lang="en"><head><title>Monitoring dashboard</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>#list,#traffic,.error,button,h1,input{border-radius:5px}#last,.status-dot{display:inline-block}button,h1,h1 a,input,th{color:#ecf0f1}a{text-decoration:none}#right,h1 a{float:right}a:hover{text-decoration:underline}td,td a,th{padding:5px 8px}#list{overflow-x:auto}table{width:100%;border-collapse:separate;border-spacing:0}body,td a{color:#333}.error,.offline .status-dot{background-color:#f44336}button,h1,input,th{background-color:#2c3e50}button,th{cursor:pointer;transition:background-color .15s}#traffic,table{background-color:#fff;max-width:100vw;white-space:nowrap}#list,#traffic,button,h1,input{box-shadow:0 1px 3px rgba(0,0,0,.1)}th{text-wrap:nowrap;position:relative}*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}body{background-color:#ebebeb;padding:15px}.dashboard{max-width:100%;margin:0 auto}#traffic,.error,button,h1{margin-bottom:15px}h1{padding:12px;font-size:1.5rem}#traffic{padding:10px;font-size:.9rem}#last,table,th{font-size:.85rem}.loading{text-align:center;padding:30px;font-size:1rem;color:#777}.error{color:#fff;padding:10px}td,th{text-align:left;border-bottom:1px solid #ddd}button:hover,th:hover{background-color:#34495e}th::after{content:'';position:absolute;right:5px;opacity:.5}td a{display:block}th.sort-asc::after{content:'\25b2'}th.sort-desc::after{content:'\25bc'}#last,#right,h1,th,button,footer,input::placeholder{user-select:none}td:first-child{padding:0!important;cursor:pointer;font-weight:700}.green{color:#4caf50}.orange{color:#ff9800}.red{color:#f44336}.offline{background-color:rgba(244,67,54,.1)}.status-dot{width:8px;height:8px;border-radius:50%;margin-right:6px;background-color:#4caf50}button,input{border:none;padding:8px 12px;font-size:.9rem}#last{margin-left:10px;color:#777}@media (max-width:44rem){#right,.hide-mobile,h1 a,td:nth-child(n+2),th:nth-child(n+2){display:none}td:first-child,th:first-child{width:100vw}#last{margin-bottom:1rem}}tr:last-child td{border-bottom:0}tr:nth-child(2n):not(.offline):not(:last-child){background-color:#f7f7f7}#total td{background-color:#f3f3f3}footer,footer a{text-align:center;margin-top:1rem;color:#999!important;font-size:.7rem;font-weight:400}footer a:hover{color:#666!important}@media (prefers-color-scheme:dark){body,td a{color:#e0e0e0}body{background-color:#121212}#traffic,table,tr:nth-child(2n):not(.offline):not(:last-child){background-color:#282828}button,h1,input,th{background-color:#233443;color:#ecf0f1}td,th{border-color:#333}tr:nth-child(odd):not(.offline):not(:last-child){background-color:#2f2f2f}#total td{background-color:#212121}footer,footer a{color:#555!important}footer a:hover{color:#777!important}}#total td:first-child{padding-left:22px!important;cursor:auto}input{margin-left:1rem;outline:0}</style></head><body><div class="dashboard"><h1><span id="title">Loading...</span><a href="/admin">Admin area</a></h1><button onclick="fetchData()">Refresh</button><span id="last"></span><input class="hide-mobile" type="text" placeholder="Filter by name..." onkeyup="updateFilter(this.value)"><div id="traffic">Loading traffic data...</div><div id="list"><div class="loading">Loading monitors data...</div></div></div><script>var monitors=[],sortColumn=0,sortDirection="asc",sizes="KMGTPE",hidden=[],page=window.location.pathname,filter=!1;function updateFilter(t){filter=t.toLowerCase(),applyFilter()}function applyFilter(){!1!==filter&&(document.querySelectorAll("tbody tr[data-monitor]").forEach(t=>{var e=t.getAttribute("data-monitor");monitors.find(t=>t.at(-1)===e)[0].toLowerCase().includes(filter)?t.style="":t.style.display="none"}),""===filter)&&(filter=!1)}function formatBytes(t){var e;return 0===t?"0 B":(e=Math.floor(Math.log(t)/Math.log(1024)),parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+(0<e?sizes[e-1]:"")+"B")}function formatNetworkSpeed(t){var e;return 0===t?"0 bit/s":(t=8*t,e=Math.floor(Math.log(t)/Math.log(1e3)),parseFloat((t/Math.pow(1e3,e)).toFixed(2))+" "+(0<e?sizes[e-1]:"")+"bit/s")}(page=page.startsWith("/")?page.slice(1):page).endsWith("/")&&(page=page.slice(0,-1));var formatUptime=t=>`${Math.floor(t/86400)}d ${Math.floor(t%86400/3600)}h ${Math.floor(t%3600/60)}m`,$=t=>document.getElementById(t);function getColor(t,e){switch(e){case"steal":return t<5?"green":t<10?"orange":"red";case"iowait":return t<10?"green":t<30?"orange":"red";default:return t<65?"green":t<85?"orange":"red"}}function fetchData(){fetch("/api/page/"+page).then(t=>{if(200!=t.status)throw new Error;return t.json()}).then(t=>{monitors=t.monitors,hide(),$("title").innerHTML='<span class="hide-mobile">Monitoring dashboard - </span>'+t.name,document.title="Monitoring dashboard - "+t.name;var e='<span style="user-select:none">&nbsp;</span>',o=(0===t.traffic[0]&&0===t.traffic[1]||(e=`<b>All-time traffic:</b> RX: ${formatBytes(t.traffic[0])} | TX: `+formatBytes(t.traffic[1])),$("traffic").innerHTML=e+'<span id="right">Click on the name of a monitor to show statistics.</span>',0===monitors.length?$("traffic").style.display="none":$("traffic").style="",($("table")?updateTable:displayMonitors)(),document.querySelectorAll("th")),r=(hidden.forEach((t,e)=>{o[e]&&(t?o[e].style.display="none":o[e].style="")}),applyFilter(),0);monitors.forEach(t=>{3==t.length&&++r}),$("last").innerHTML=`<span class="hide-mobile">Last updated: ${(new Date).toLocaleTimeString()} | </span>Monitors: ${monitors.length} (${r} offline)`}).catch(()=>$("list").innerHTML='<div class="error">Fetching data failed!</div>')}function tableRow(t,o){var r="";return t.forEach((t,e)=>{!0!==hidden[e]&&("string"==typeof(t="number"==typeof t&&-1===o[t]||"object"==typeof t&&-1===o[t[0]]?"":t)?r+=`<td>${t}</td>`:"number"==typeof t?r+=`<td>${o[t]}</td>`:"object"==typeof t&&(2===t.length?r+=`<td>${t[1](o[t[0]])}</td>`:3===t.length&&(r+=`<td class="${getColor(o[t[0]],t[2])}">${t[1](o[t[0]])}</td>`)))}),r}var percent=t=>t.toFixed(2)+"%",monitorInnerHTML=t=>tableRow([`<a href="/monitor/${t.at(-1)}"><span class="status-dot"></span>${t[0]}</a>`,1,2,3,[4,formatUptime],[5,percent,!0],[6,percent,"iowait"],[7,percent,"steal"],[8,formatBytes],[9,percent,!0],[10,formatBytes],[11,percent,!0],[12,formatBytes],[13,percent,!0],[14,formatNetworkSpeed],[15,formatNetworkSpeed],[16,t=>formatBytes(t)+"/s"],[17,t=>formatBytes(t)+"/s"]],t),offlineString=t=>null===t?"Offline":t<3600?`Offline for ${Math.floor(t/60)} minutes`:`Offline for ${Math.floor(t/3600)} hours, ${Math.floor(t%3600/60)} minutes`,monitorOfflineInnerHTML=t=>`<td class="offline"><a href="/monitor/${t[2]}"><span class="status-dot"></span>${t[0]}</td><td style="width:100%" colspan="17" class="offline">${offlineString(t[1])}</a></td>`;function calculateTotals(){var r,a,n,i;return!(1===monitors.length||window.matchMedia("(max-width:44rem)").matches||(r=[],a=[],n=[],i=[],monitors.forEach(t=>{if(3!=t.length)for(var e,o=0;o<18;++o)"string"!=typeof t[o]&&-1!==t[o]&&(void 0===a[o]?a[o]=1:++a[o],(9===o||11===o||13===o)&&-1!==t[o-1]?(e=t[o-1]*t[o],n[o]?n[o]+=e:n[o]=e,--a[o],void 0===i[o]?i[o]=1:++i[o]):r[o]?r[o]+=t[o]:r[o]=t[o])}),Math.max(...a)<=1))&&([5,6,7].forEach(t=>{0!==a[t]&&(r[t]/=a[t])}),[9,11,13].forEach(t=>{var e=void 0===r[t]?0:r[t],o=void 0===a[t]?0:a[t];void 0!==i[t]&&0!==i[t]&&void 0!==r[t-1]&&0<r[t-1]&&(e+=n[t]/r[t-1]*i[t],o+=i[t]),0<o&&(e/=o),r[t]=e}),tableRow(["Totals/averages","","",3,"",[5,percent,!0],[6,percent,"iowait"],[7,percent,"steal"],[8,formatBytes],[9,percent,!0],[10,formatBytes],[11,percent,!0],[12,formatBytes],[13,percent,!0],[14,formatNetworkSpeed],[15,formatNetworkSpeed],[16,t=>formatBytes(t)+"/s"],[17,t=>formatBytes(t)+"/s"]],r))}function hide(){hidden=[!1];for(var t=1;t<18;++t)hidden[t]=!0;monitors.forEach(o=>{o.forEach((t,e)=>{18!==e&&3!==o.length&&-1!==o[e]&&(hidden[e]=!1)})})}function displayMonitors(){var o,t,e=$("list");0===monitors.length?e.innerHTML='<div class="info">No monitor data available.</div>':(o='<table id="table"><thead><tr>',["Name","Kernel","CPU","Cores","Uptime","CPU %","IOwait %","Steal %","RAM","RAM %","Swap","Swap %","Disk","Disk %","Net RX","Net TX","Read IO","Write IO"].forEach((t,e)=>o+=`<th onclick="sortTable(${e})">${t}</th>`),o+="</tr></thead></tbody>",monitors.forEach(t=>{3===t.length?o+=`<tr data-monitor="${t.at(-1)}" class="offline">${monitorOfflineInnerHTML(t)}</tr>`:o+=`<tr data-monitor="${t.at(-1)}">${monitorInnerHTML(t)}</tr>`}),(t=calculateTotals())&&(o+=`<tr id="total">${t}</tr>`),e.innerHTML=o,sortTableDOM(),updateSortIndicators())}function sortTable(t){sortDirection=sortColumn===t?"asc"===sortDirection?"desc":"asc":(sortColumn=t,"asc"),sortTableDOM(),updateSortIndicators()}function updateSortIndicators(){document.querySelectorAll("th").forEach((t,e)=>{t.classList.remove("sort-asc","sort-desc"),e===sortColumn&&t.classList.add("sort-"+sortDirection)})}function updateTable(){var o=document.querySelector("tbody"),r={},t=(o.querySelectorAll("tr[data-monitor]").forEach(t=>r[t.getAttribute("data-monitor")]=t),monitors.forEach(t=>{var e;r[t[0]]?(3===t.length?(r[t[0]].className="offline",r[t[0]].innerHTML=monitorOfflineInnerHTML(t)):(r[t[0]].className="",r[t[0]].innerHTML=monitorInnerHTML(t)),delete r[t[0]]):((e=document.createElement("tr")).setAttribute("data-monitor",t.at(-1)),3===t.length?(e.className="offline",e.innerHTML=monitorOfflineInnerHTML(t)):e.innerHTML=monitorInnerHTML(t),o.appendChild(e))}),Object.keys(r).forEach(t=>o.removeChild(r[t])),calculateTotals()),e=$("total");t?(e||((e=document.createElement("tr")).id="total",o.appendChild(e)),e.innerHTML=t):e&&o.removeChild(e),sortTableDOM(),updateSortIndicators()}function sortTableDOM(){var e=document.querySelector("tbody"),t=Array.from(e.querySelectorAll("tr[data-monitor]")),t=(t.sort((t,e)=>{var o=t.getAttribute("data-monitor"),r=e.getAttribute("data-monitor"),t=monitors.find(t=>t.at(-1)===o),e=monitors.find(t=>t.at(-1)===r);return t&&e?3===t.length&&3===e.length?t[0].localeCompare(e[0])*("asc"===sortDirection?1:-1):3!==t.length&&-1!==t[sortColumn]||0===sortColumn?3!==e.length&&-1!==e[sortColumn]||0===sortColumn?"string"==typeof t[sortColumn]?t[sortColumn].localeCompare(e[sortColumn])*("asc"===sortDirection?1:-1):(t[sortColumn]-e[sortColumn])*("asc"===sortDirection?1:-1):(3===e.length?1:-1)*("asc"===sortDirection?-1:1):(3===t.length?1:-1)*("asc"===sortDirection?1:-1):0}),t.forEach(t=>e.appendChild(t)),$("total"));t&&e.appendChild(t)}document.addEventListener("DOMContentLoaded",fetchData),setInterval(()=>{"string"==typeof document.visibilityState&&"hidden"===document.visibilityState||fetchData()},2e4),document.addEventListener("visibilitychange",()=>{"string"==typeof document.visibilityState&&"hidden"!==document.visibilityState&&fetchData()}),document.addEventListener("keydown",t=>{"F5"===t.key&&(t.preventDefault(),fetchData())});</script><footer>Powered by <a href="https://ltstats.de">LTstats</a></footer></body></html>