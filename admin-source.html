<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Monitoring admin area</title><style>.header,h1,th,footer,button{user-select:none}*,.url-prefix{box-sizing:border-box}.tab,button:hover{background:#34495e}#login,table{background:#fff}.tab,button,h1,th{color:#ecf0f1}#error,h1,label.page-public,label.url{margin-bottom:1rem}#error,#save,.hidden{display:none}.close,.tab,button,label{cursor:pointer}.threshold-header,label{user-select:none;font-weight:700}*{margin:0;padding:0;font-family:sans-serif}body{background:#ebebeb;color:#333;padding:15px}#login{max-width:20rem;margin:5rem auto;padding:2rem}a{color:#333!important;text-decoration:none;font-weight:700}a:hover{text-decoration:underline}#container{max-width:100%}#login,button,h1,table{box-shadow:0 1px 3px rgba(0,0,0,.1)}h1{padding:12px;font-size:1.5rem}.tabs{margin-bottom:.75rem}.tab{padding:10px 20px;border:none;border-radius:0;margin-right:5px}.tab.active{background:#1c6bb8}button,h1{background-color:#2c3e50}#login,.modal .content,button,h1,table{border-radius:5px}#save{align-items:center;gap:10px;float:right;font-size:1rem;font-weight:400}button{border:none;padding:8px 12px;margin:2px}.modal button,table button{padding:6px 8px}table{width:100%;border-collapse:collapse}td,th{padding:1px 6px;text-align:left;border-bottom:1px solid #ddd}th{background:#2c3e50;padding-top:.3rem;padding-bottom:.3rem}tr:nth-child(2n){background:#f7f7f7}h1 button{background-color:#243342}#login-form{display:flex;flex-direction:column;gap:1rem}input[type=checkbox]{width:auto}.grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem}.grid label{display:flex;flex-direction:column}.modal{position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.5)}.modal-content{background:#fff;margin:2.5% auto;padding:2rem;width:80%;max-width:40rem;max-height:90vh;overflow-y:auto}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.close{font-size:28px;color:#aaa}.close:hover{color:#000}#error{padding:1rem;background:#f44336;color:#fff;border-radius:3px}.list{max-height:50vh;overflow-y:auto;border:1px solid #ddd;padding:10px;border-radius:3px}input,select,textarea{padding:8px;border-radius:3px;transition:.2s;outline:0;font-size:.9rem;border:1px solid #ddd;background-color:#fff}.url-input-group:hover .url-prefix,input:hover,label.url:hover .url-input-group:not(:focus-within) .url-prefix,select:hover,textarea:hover{border-color:#bbb}input:focus,select:focus,textarea:focus{border-color:#1c6bb8;box-shadow:0 0 0 2px rgba(28,107,184,.2);background:#fafafa}textarea{resize:vertical}.url-input-group{display:flex;transition:.2s}.url-prefix{padding:8px 0 8px 6px;border:1px solid #ddd;border-right:none;border-radius:3px 0 0 3px;color:#666;font-size:.9rem;white-space:nowrap;transition:.2s}.url-input-group input{border-radius:0 3px 3px 0;border-left:none;box-shadow:none}.url-input-group:focus-within .url-prefix{border-color:#1c6bb8}.url-input-group:focus-within{box-shadow:0 0 0 2px rgba(28,107,184,.2);border-radius:3px}footer,footer a{text-align:center;margin-top:1rem;color:#999!important;font-size:.7rem;font-weight:400}footer a:hover{color:#666!important}@media (prefers-color-scheme:dark){body{background:#121212;color:#e0e0e0}a{color:#e0e0e0!important}#login,.modal-content,table{background:#282828;color:#e0e0e0}h1 button{background-color:#1a2732}td,th{border-color:#444}tr:nth-child(2n){background:#333}button,h1{background-color:#233443}.list,input,select,textarea{background:#333;color:#e0e0e0;border-color:#555}.close:hover{color:#fff}#monitors tr button:nth-of-type(2){background-color:#2c4154}#monitors tr button:nth-of-type(2):hover{background-color:#354e64}.url-prefix,input,select,textarea{background-color:#333;color:#e0e0e0;border-color:#555}.url-input-group:hover .url-prefix,input:hover,label.url:hover .url-input-group:not(:focus-within) .url-prefix,select:hover,textarea:hover{border-color:#666}input:focus,select:focus,textarea:focus{background-color:#3a3a3a;border-color:#1c6bb8}.url-prefix{color:#bbb}.url-input-group:focus-within .url-prefix{border-color:#1c6bb8;background-color:#3a3a3a}footer,footer a{color:#555!important}footer a:hover{color:#777!important}}#monitors tr button:nth-of-type(3),#pages tr button:nth-of-type(2),h1 button:nth-of-type(2){background-color:#f44336}#monitors tr button:nth-of-type(3):hover,#pages tr button:nth-of-type(2):hover,h1 button:nth-of-type(2):hover{background-color:#f66055}table tr button:first-of-type{background-color:#1c6bb8}table tr button:first-of-type:hover{background-color:#2180de}#monitors tr button:nth-of-type(4){background-color:#062}#monitors tr button:nth-of-type(4):hover{background-color:#007025}label input[type=number],label textarea{display:block;width:100%}.line{display:block;margin-top:.5rem}code{font-family:monospace}#notification-settings-modal textarea,input.seperate,select{width:100%;margin-top:.2rem;margin-bottom:.3rem}.add{margin:0 0 .5rem}.threshold-header{font-size:1.1rem;margin-top:.85rem}#page-path{padding-left:0;margin:0}body:has(.modal:not(.hidden)){overflow:hidden}</style></head><body><div id="container" class="hidden"><div id="login"><h1>Admin login</h1><div id="error"></div><div id="login-form"><label for="password">Password:</label><input type="password" id="password" onkeypress="'Enter'===event.key&&login();"><button onclick="login();">Login</button></div></div><div id="admin" class="hidden"><h1>Monitoring admin area<span id="save">Unsaved changes<button onclick="save();">Save</button><button onclick="discard();">Discard</button><button onclick="forceSave();" id="force">Force save</button></span></h1><div class="tabs"><button class="tab active" onclick="showTab('monitors');">Monitors</button><button class="tab" onclick="showTab('pages');">Status pages</button><button class="tab" onclick="showTab('settings');">Settings</button></div><div id="monitors" class="content"><button onclick="editMonitor();" class="add">Add monitor</button><table><thead><tr><th>Name</th><th>Public</th><th>Actions</th></tr></thead><tbody></tbody></table></div><div id="pages" class="content hidden"><button onclick="editPage();" class="add">Add status page</button><table><thead><tr><th>Name</th><th>URL</th><th>Public</th><th>Monitors</th><th>Actions</th></tr></thead><tbody></tbody></table></div><div id="settings" class="content hidden"><label class="line">Change password: <input type="password" placeholder="New password" oninput="changePassword(this.value);"></label><label class="line">Copy command (<code>DOMAIN</code> will be replaced with the domain, <code>TOKEN</code> will be replaced with the token, <code>ADDITIONAL_PATHS</code> will be replaced with the additional paths to be monitored and <code>NAME</code> will be replaced with the name): <select onchange="$('copy').value=this.value;data.copy=this.value;possiblyChanged();" style="width:auto;padding:.05rem .5rem"><option disabled selected>-- Select --</option><option value="curl -s https://ltstats.de/v1.3/systemd:agent | tee install.sh | sha256sum -c <(echo 123bdcc123d39dfe915eb3ed9223ea75c845a8bef5c79b994f4b2de20530085c -) && bash install.sh DOMAIN TOKEN ntp ADDITIONAL_PATHS # NAME">systemd + ntp client</option><option value="curl -s https://ltstats.de/v1.3/systemd:agent | tee install.sh | sha256sum -c <(echo 123bdcc123d39dfe915eb3ed9223ea75c845a8bef5c79b994f4b2de20530085c -) && bash install.sh DOMAIN TOKEN no-ntp ADDITIONAL_PATHS # NAME">systemd</option><option value="">Custom</option></select><input class="seperate" id="copy" oninput="data.copy=this.value,possiblyChanged();"></label><div class="line">Hide settings (for private monitors): <button onclick="editHide();">Edit</button></div><div class="line">Notification settings: <button onclick="editNotifications();">Edit</button></div></div></div></div><div id="monitor-modal" class="modal hidden"><div class="modal-content"><div class="header"><h2></h2><span class="close" onclick="closeModals();">&times;</span></div><label class="line">Name:<br><input id="monitor-name" class="seperate"></label><label class="line"><input type="checkbox" id="monitor-public"> Public</label><label class="line">Note:<textarea id="monitor-note" rows="3"></textarea></label><label class="line"><input type="checkbox" id="monitor-note-public"> Note is public</label><div class="line threshold-header">Monitoring thresholds:<button type="button" onclick="applyDefaults();">Apply defaults</button><button type="button" onclick="applyToAll();">Apply to all</button></div><div class="line"><div class="grid"><label>Offline (minutes):<input type="number" min="0"></label><label>CPU Usage (%):<input type="number" min="1" max="100"></label><label>CPU IOWait (%):<input type="number" min="1" max="100"></label><label>CPU Steal (%):<input type="number" min="1" max="100"></label><label>RAM Usage (%):<input type="number" min="1" max="100"></label><label>Swap Usage (%):<input type="number" min="1" max="100"></label><label>Disk Usage (%):<input type="number" min="1" max="100"></label><label>Net RX (bps):<input type="number" min="1"></label><label>Net TX (bps):<input type="number" min="1"></label><label>Disk Read (Bps):<input type="number" min="1"></label><label>Disk Write (Bps):<input type="number" min="1"></label></div></div><label class="line">Additional filesystems/partitions to be monitored (space seperated, specify any path within the mounted fileystem):<br><input id="monitor-additional-paths" class="seperate"></label><div class="line"><button onclick="saveMonitor();">Save</button><button onclick="closeModals();">Cancel</button></div></div></div><div id="page-modal" class="modal hidden"><div class="modal-content"><div class="header"><h2></h2><span class="close" onclick="closeModals();">&times;</span></div><label class="line">Name:<input id="page-name" class="seperate"></label><label class="line url">URL:<div class="url-input-group"><span class="url-prefix" id="domain"></span><input id="page-path" class="seperate"></div></label><label class="line page-public"><input type="checkbox" id="page-public"> Public</label><label class="line">Monitors:</label><div id="page-modal-monitors" class="list"></div><div class="line"><button onclick="savePage();">Save</button><button onclick="closeModals();">Cancel</button></div></div></div><div id="add-to-page-modal" class="modal hidden"><div class="modal-content"><div class="header"><h2>Add monitor to status page</h2><span class="close" onclick="closeModals();">&times;</span></div><label class="line">Select status page:<select id="page-select"></select></label><div class="line"><button onclick="addMonitorToPage();">Add</button><button onclick="closeModals();">Cancel</button></div></div></div><div id="hide-private-modal" class="modal hidden"><div class="modal-content"><div class="header"><h2>Hide settings (for private monitors):</h2><span class="close" onclick="closeModals();">&times;</span></div><div class="line" id="hide-select"></div><div class="line"><button onclick="saveHide();">Save</button><button onclick="closeModals();">Cancel</button></div></div></div><div id="notification-settings-modal" class="modal hidden"><div class="modal-content"><div class="header"><h2>Notification settings</h2><span class="close" onclick="closeModals();">&times;</span></div><label class="line">Check every (seconds):<input type="number" id="notification-every" min="1"></label><label class="line">Sample period (minutes):<input type="number" id="notification-sample" min="1"></label><label class="line">Command (space seperated, <code>NAME</code>, <code>TYPE</code>, <code>PUBLIC_TOKEN</code> and <code>STATUS</code> will be replaced, <code>TYPE</code> is one of <code>{DOWN, CPU_USAGE, CPU_IOWAIT, CPU_STEAL, RAM_USAGE, SWAP_USAGE, DISK_USAGE, NET_RX, NET_TX, DISK_READ, DISK_WRITE}</code> and <code>STILL_MET</code> is <code>TRUE</code> or <code>FALSE</code>):<textarea id="notification-exec" rows="3"></textarea></label><div class="line threshold-header">Default monitoring thresholds:</div><div class="line"><div class="grid"><label>Offline (minutes):<input type="number" min="0"></label><label>CPU Usage (%):<input type="number" min="1" max="100"></label><label>CPU IOWait (%):<input type="number" min="1" max="100"></label><label>CPU Steal (%):<input type="number" min="1" max="100"></label><label>RAM Usage (%):<input type="number" min="1" max="100"></label><label>Swap Usage (%):<input type="number" min="1" max="100"></label><label>Disk Usage (%):<input type="number" min="1" max="100"></label><label>Net RX (bps):<input type="number" min="1"></label><label>Net TX (bps):<input type="number" min="1"></label><label>Disk Read (Bps):<input type="number" min="1"></label><label>Disk Write (Bps):<input type="number" min="1"></label></div></div><div class="line"><button onclick="saveNotifications();">Save</button><button onclick="closeModals();">Cancel</button></div></div></div><script>
var data, original, editing;

var $ = id => document.getElementById(id);

var hex = d => d.map(b => b.toString(16).padStart(2, '0')).join('');

async function hash(str) {
    return hex(Array.from(new Uint8Array(await crypto.subtle.digest('SHA-256', (new TextEncoder()).encode(str)))));
}

function newToken() {
    var token;
    do
        token = hex(Array.from(crypto.getRandomValues(new Uint8Array(16))));
    while (data.monitors[token] !== undefined || Object.entries(data.monitors).filter(a => a[1][0] === token).length !== 0);
    return token;
}

function compare(a, b) {
    if (a === b)
        return true;
    if (a === null || b === null || typeof a !== 'object' || typeof b !== 'object')
        return false;
    var c = Object.keys(a);
    var d = Object.keys(b);
    if(c.length !== d.length)
        return false;
    for(var k of c)
        if(!Object.hasOwn(b, k) || !compare(a[k], b[k]))
            return false;
    return true;
}

function possiblyChanged() {
    if (!compare(original, data)) {
        $('save').style.display = 'flex';
        $('force').style.display = 'none';
    } else
        $('save').style = '';
}

function showTab(name) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.content').forEach(t => t.classList.add('hidden'));
    event.target.classList.add('active');
    $(name).classList.remove('hidden');
}

var closeModals = () => document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));

function checkAuth() {
    fetch('/admin/logged_in')
    .then(data => {
        if (data.ok) {
            $('login').style.display = 'none';
            $('admin').style.display = 'block';
            loadData();
        } else
            throw new Error();
    })
    .catch(() => $('container').classList.remove('hidden'));
}

function login() {
    hash($('password').value)
    .then(hash => {
        fetch('/admin/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({hash: hash})
        })
        .then(data => {
            if (data.ok) {
                $('login').style.display = 'none';
                $('admin').style.display = 'block';
                loadData();
            } else {
                var err = $('error');
                err.textContent = 'Invalid password';
                err.style.display = 'block';
            }
        })
        .catch(() => {
            var err = $('error');
            err.textContent = 'Login failed';
            err.style.display = 'block';
        });
    });
}

function loadData() {
    fetch('/admin/data')
    .then(response => {
        if (response.status != 200)
            throw new Error();
        return response.json();
    })
    .then(d => {
        data = d;
        original = structuredClone(data);
        refresh();
        $('container').classList.remove('hidden');
    })
    .catch(() => alert('Failed to load data'));
}

function save() {
    fetch('/admin/data', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => {
        if (response.status === 409) {
            alert('There is a conflict. You can force saving.');
            $('force').style.display = 'inline';
            return;
        }
        if (response.ok) {
            original = structuredClone(data);
            $('save').style.display = 'none';
            loadData();
        } else
            alert('Saving failed');
    })
    .catch(() => alert('Saving failed'));
}


function forceSave() {
    data.time = 0;
    save();
    $('force').style.display = 'none';
}

function discard() {
    data = structuredClone(original);
    $('save').style.display = 'none';
    refresh();
}

function refresh() {
    refreshMonitors();
    refreshPages();
    $('copy').value = data.copy;
}

function refreshMonitors() {
    var tbody = $('monitors').querySelector('tbody');
    tbody.innerHTML = '';
    for (var [token, monitor] of Object.entries(data.monitors).reverse())
        tbody.insertRow().innerHTML = `<td><a href="/monitor/${token}">${monitor[1]}</a></td><td>${monitor[2] ? 'Yes' : 'No'}</td><td><button onclick="editMonitor('${token}');">Edit</button><button onclick="copy('${token}');">Copy command</button><button onclick="deleteMonitor('${token}');">Delete</button><button onclick="showAddToPageModal('${token}');">Add to status page</button></td>`;
}

function refreshPages() {
    var tbody = $('pages').querySelector('tbody');
    tbody.innerHTML = '';
    for (var [path, page] of Object.entries(data.pages))
        tbody.insertRow().innerHTML = `<td><a href="/${path}">${page[0]}</a></td><td><a style="font-weight:normal" href="/${path === 'main' ? '' : path}">https://${window.location.host}${path === 'main' ? '' : `/${path}`}</a>${path === 'main' ? '<span style="user-select:none"> (when not logged in)</span>' : ''}</td><td>${page[1] ? 'Yes' : 'No'}</td><td>${page[2].length}</td><td><button onclick="editPage('${path}');">Edit</button>${path === 'main' ? '' : `<button onclick="deletePage('${path}');">Delete</button>`}</td>`;
}

function editMonitor(token = null) {
    editing = token;
    $('monitor-modal').querySelector('h2').textContent = token ? 'Edit monitor' : 'Add monitor';
    document.querySelectorAll('input[type=number],#monitor-note,#monitor-name').forEach(input => input.value = '');
    $('monitor-public').checked = true;
    $('monitor-note-public').checked = false;
    $('monitor-additional-paths').value = '';
    if (token) {
        var m = data.monitors[token];
        $('monitor-name').value = m[1];
        $('monitor-public').checked = m[2];
        if (m[3]) {
            $('monitor-note').value = m[3][0];
            $('monitor-note-public').checked = m[3][1];
        } else {
            $('monitor-note').value = '';
            $('monitor-note-public').checked = false;
        }
        if (m[4])
            $('monitor-modal').querySelectorAll('input[type=number]').forEach((element, index) => element.value = m[4][index]);
        $('monitor-additional-paths').value = m[5].join(' ');
    } else
        applyDefaults();
    $('monitor-modal').classList.remove('hidden');
}

function parseGrid(id) {
    var d = [];
    $(id).querySelectorAll('.grid input[type=number]').forEach((e, i) => d[i] = parseInt(e.value) === 0 ? 0 : (parseInt(e.value) || false));
    return d.some(v => v !== false) ? d : false;
}

function saveMonitor() {
    var name = $('monitor-name').value;
    if (!name) {
        alert('Name is required');
        return;
    }
    var token = editing || newToken();
    var monitor = data.monitors[token] || [];
    if (!editing)
        monitor[0] = newToken();
    monitor[1] = name;
    monitor[2] = $('monitor-public').checked;
    var note = $('monitor-note').value;
    monitor[3] = note ? [note, $('monitor-note-public').checked] : false;
    monitor[4] = parseGrid('monitor-modal');
    monitor[5] = $('monitor-additional-paths').value.split(' ');
    data.monitors[token] = monitor;
    possiblyChanged();
    closeModals();
    refreshMonitors();
}

function deleteMonitor(token) {
    if (!confirm('Delete monitor?'))
        return;
    delete data.monitors[token];
    for (var page of Object.values(data.pages))
        page[2] = page[2].filter(m => m !== token);
    possiblyChanged();
    refresh();
}

function copy(token) {
    var paths = data.monitors[token][5].join(' ');
    if (paths !== '')
        paths = `"${paths}"`;
    navigator.clipboard.writeText(data.copy.replaceAll('TOKEN', data.monitors[token][0]).replaceAll('ADDITIONAL_PATHS', paths).replaceAll('DOMAIN', window.location.host).replaceAll('NAME', data.monitors[token][1]).trim());
}

function applyDefaults() {
    if (!data.notifications.default)
        return;
    $('monitor-modal').querySelectorAll('input[type=number]').forEach((element, index) => element.value = data.notifications.default[index]);
}

function applyToAll() {
    if (!confirm('Apply to all monitors?'))
        return;
    var d = parseGrid('monitor-modal');
    for (var monitor of Object.values(data.monitors))
        monitor[4] = d;
    possiblyChanged();
}

function showAddToPageModal(token) {
    editing = token;
    var select = $('page-select');
    select.innerHTML = '';
    for (var [path, page] of Object.entries(data.pages))
        if (!page[2].includes(token)) {
            var option = document.createElement('option');
            option.value = path;
            option.textContent = `${page[0]} (${path})`;
            select.appendChild(option);
        }
    if (select.children.length === 0) {
        alert('Monitor is already on all available status pages.');
        return;
    }
    $('add-to-page-modal').classList.remove('hidden');
}

function addMonitorToPage() {
    var selected = $('page-select').value;
    if (!selected)
        return;
    var page = data.pages[selected];
    page[2].push(editing);
    possiblyChanged();
    closeModals();
    refreshPages();
}

function editPage(path = null) {
    editing = path;
    $('page-modal').querySelector('h2').textContent = path ? 'Edit status page' : 'Add status page';
    $('domain').innerHTML = `https://${window.location.host}/`;
    if (path) {
        var p = data.pages[path];
        $('page-path').value = path === 'main' ? '' : path;
        $('page-path').disabled = path === 'main';
        $('page-name').value = p[0];
        $('page-public').checked = p[1];
        populatePageMonitors(p[2]);
    } else {
        $('page-path').value = '';
        $('page-name').value = '';
        $('page-public').checked = false;
        populatePageMonitors([]);
    }
    $('page-modal').classList.remove('hidden');
}

function populatePageMonitors(selected = []) {
    var div = $('page-modal-monitors');
    div.innerHTML = '';
    for (var [token, monitor] of Object.entries(data.monitors || {})) {
        var item = document.createElement('div');
        item.innerHTML = `<label><input type="checkbox" value="${token}" ${selected.includes(token) ? 'checked' : ''}> ${monitor[1]}</label>`;
        div.appendChild(item);
    }
}

function savePage() {
    var path = $('page-path').value;
    if (editing === 'main')
        path = 'main';
    var name = $('page-name').value;
    if (!path || !name) {
        alert('Path and name required!');
        return;
    }
    if (data.pages[path] && editing != path && !confirm('This path already exists. Do you want to overwrite that status page?'))
        return;
    if (editing && editing !== path)
        delete data.pages[editing];
    var selected = Array.from($('page-modal-monitors').querySelectorAll('input:checked')).map(i => i.value);
    data.pages[path] = [name, $('page-public').checked, selected];
    possiblyChanged();
    closeModals();
    refreshPages();
}

function deletePage(path) {
    if (!confirm('Delete page?'))
        return;
    delete data.pages[path];
    possiblyChanged();
    refreshPages();
}

function editHide() {
    var div = $('hide-select');
    div.innerHTML = '';            
    ['TOTAL_IO', 'TOTAL_TRAFFIC', 'KERNEL', 'CPU_MODEL', 'CPU_CORES', 'UPTIME', 'CPU_USAGE', 'CPU_IOWAIT', 'CPU_STEAL', 'RAM_SIZE', 'RAM_USAGE', 'SWAP_SIZE', 'SWAP_USAGE', 'DISK_SIZE', 'DISK_USAGE', 'NET', 'IO'].forEach(opt => {
        var item = document.createElement('div');
        item.innerHTML = `<label><input type="checkbox" value="${opt}"${data.hide.includes(opt) ? ' checked' : ''}> ${opt}</label>`;
        div.appendChild(item);
    });
    $('hide-private-modal').classList.remove('hidden');
}

function saveHide() {
    data.hide = Array.from($('hide-select').querySelectorAll('input:checked')).map(i => i.value);
    possiblyChanged();
    closeModals();
    refreshSettings();
}

function editNotifications() {
    var n = data.notifications;
    $('notification-every').value = n.every;
    $('notification-sample').value = n.sample;
    $('notification-exec').value = n.exec.join(' ');
    if (n.default)
        $('notification-settings-modal').querySelectorAll('.grid input[type=number]').forEach((element, index) => element.value = n.default[index]);
    $('notification-settings-modal').classList.remove('hidden');
}

function saveNotifications() {
    var every = parseInt($('notification-every').value);
    var sample = parseInt($('notification-sample').value);
    if (!every || !sample) {
        alert('Every and sample required to be an integer bigger than 0!');
        return;
    }
    data.notifications.every = every;
    data.notifications.sample = sample;
    data.notifications.exec = $('notification-exec').value.split(' ');
    data.notifications.default = parseGrid('notification-settings-modal');
    possiblyChanged();
    closeModals();
}

function changePassword(password) {
    if (password === '') {
        data.hash = original.hash;
        possiblyChanged();
    } else {
        hash(password)
        .then(hash => {
            data.hash = hash;
            possiblyChanged();
        });
    }
}

document.addEventListener('keydown', e => {
    if (e.key === 'Escape')
        closeModals();
});

window.addEventListener('beforeunload', e => {
    if (!compare(original, data)) {
        e.preventDefault();
        e.returnValue = '';
    }
});

window.addEventListener('click', () => {
    if (event.target.className === 'modal')
        closeModals();
});

window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input[type=number]').forEach(e => {
        if (e.min !== undefined || e.max !== undefined)
            e.addEventListener('change', () => {
                if (e.value === '')
                    return;
                if (parseInt(e.value) > parseInt(e.max))
                    e.value = e.max;
                if (parseInt(e.value) < parseInt(e.min))
                    e.value = e.min;
            });
    });
    checkAuth();
});
</script><footer>Powered by <a href="https://ltstats.de">LTstats</a></footer></body></html>